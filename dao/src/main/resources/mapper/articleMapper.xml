<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.huyong.dao.mapper.ArticleMapper">
    <sql id="base_column_list">
        a.`id` as `article_id`,a.`title` as `title`,a.`topic_count` as `topic_count`,
        a.`praise_count` as `praise_count`,
        a.`read_count` as `read_count`,a.`floor_count` as `floor_count`,a.`user_id` as `user_id`
    </sql>
    <resultMap id="getArticlesMap" type="articleBO">
        <id property="id" column="article_id"></id>
        <result property="title" column="title"></result>
        <result property="content" column="content"></result>
        <result property="topicCount" column="topic_count"></result>
        <result property="praiseCount" column="praise_count"></result>
        <result property="readCount" column="read_count"></result>
        <result property="floorCount" column="floor_count"></result>
        <result property="userId" column="user_id"></result>
        <association property="user" column="user_id" javaType="userBO" resultMap="userMap"></association>
    </resultMap>
    <resultMap id="userMap" type="userBO">
        <id property="id" column="id"></id>
        <result property="userName" column="user_name"></result>
        <result property="gender" column="gender"></result>
        <result property="age" column="age"></result>
        <result property="school" column="school"></result>
        <result property="introduction" column="introduction"></result>
        <result property="work" column="work"></result>
        <result property="online" column="online"></result>
        <result property="picture" column="picture"></result>
        <result property="visitCount" column="visitCount"></result>
    </resultMap>
    <select id="getArticles" resultMap="getArticlesMap">
        select <include refid="base_column_list"/>, SUBSTRING(a.`content`, 1, 30) as `content`, b.*
         from `article` a inner join `user` b
         on a.user_id = b.id
        <where>
            a.`status` = 0 and b.`status` = 0
            <if test="userId != null">
                and a.user_id = #{userId}
            </if>
            <if test="type != null">
                and a.`type` = #{type}
            </if>
            <if test="kindId != null">
                and find_in_set(#{kindId}, a.`kind_ids`)
            </if>
        </where>
        order by a.`topic_count` desc, a.`praise_count` desc, a.`read_count` desc, a.`floor_count` desc,a.`create_time` desc,a.`update_time` desc
        limit #{offset}, #{pageNum}
    </select>
</mapper>
