<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.huyong.dao.mapper.HistoryChatUsersMapper">
    <select id="getUsers" resultType="historyChatUsersBO">
    SELECT
        a.*,
        b.user_name,
        b.picture,
        count( c.id ) AS unReadCount,
        b.online
    FROM
        `history_chat_user` a
        INNER JOIN `user` b ON a.customer = b.id
        LEFT JOIN `event` c ON a.customer = c.from_user_id
        AND a.user_id = c.to_user_id
        AND c.type = 1
        AND c.`status` = 0
    WHERE
        a.user_id = #{id}
        AND a.STATUS = 0
    GROUP BY
        a.customer
    ORDER BY
        a.create_time desc
    </select>
</mapper>
